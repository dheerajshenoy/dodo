app-id: io.github.dheerajshenoy.dodo

runtime: org.freedesktop.Platform
runtime-version: "6.9"
sdk: org.kde.Sdk

command: dodo

finish-args:
    - --filesystem=xdg-documents
    - --filesystem=xdg-download
    - --filesystem=~/.config/dodo
    - --filesystem=/run/media
    - --filesystem=/media
    - --filesystem=/tmp
    - --share=ipc
    - --socket=wayland
    - --socket=fallback-x11
    - --device=shm
    - --device=dri

modules:
    - name: dodo
      buildsystem: simple
      build-commands:
          - make -C external/mupdf -j${FLATPAK_BUILDER_N_JOBS} build=release HAVE_X11=no HAVE_GLUT=no
          - cmake -S . -B build -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/app -DENABLE_LLM_SUPPORT=OFF
          - cmake --build build -- -j${FLATPAK_BUILDER_N_JOBS}
          - cmake --install build
      post-install:
          - install -Dm644 resources/hicolor/256x256/apps/dodo.png /app/share/icons/hicolor/256x256/apps/io.github.dheerajshenoy.dodo.png
          - desktop-file-install --delete-original --dir=/app/share/applications io.github.dheerajshenoy.dodo.desktop
      sources:
          - type: dir
            path: ..
          - type: archive
            url: https://mupdf.com/downloads/archive/mupdf-1.27.0-source.tar.gz
            sha256: ae2442416de499182d37a526c6fa2bacc7a3bed5a888d113ca04844484dfe7c6
            dest: external/mupdf
            strip-components: 1
